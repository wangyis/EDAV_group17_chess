# Data transformation

```{r, include=FALSE}
games <- read.csv("dataset/games.csv")
```

## Cleaning Trivial Variables

The dataset has the following variables.

```{r}
colnames(games)
```

We wanted to remove ```id, created_at, last_move_at, increment_code, moves, opening_eco, opening_ply``` since some of them, like ```id``` or ```increment_code``` do not have pivotal information for our problems. Or they are providing similar information as other variables, such as ```opening_eco```.

The rest variables are:

```{r}
games <- games[-c(1,3,4,8, 13, 14,16)]
colnames(games)
```

## Cleaning Rated Status
```{r}
table(games$rated)
```

We changed all the strings to uppercase letter for consistency. 

```{r}
library(stringr)
games$rated <- str_to_upper(games$rated)
table(games$rated)
```

## Cleaning Turns
```{r}
library(ggplot2)
ggplot(data = games, aes(x = turns)) + geom_histogram(bins = 50) +
  geom_vline(xintercept = 10, color = "red")

games <- games[games$turns >= 10,]
```


## Cleaning Users
```{r}
tb <- table(c(games$white_id, games$black_id))
tb <- tb[tb >= 3]
ggplot(as.data.frame(tb), aes(x = Freq)) + geom_histogram() + geom_vline(xintercept = 3, color = "red") +
  xlab("Number of games each player played")

games <- games[(games$white_id %in% names(tb) & games$black_id %in% names(tb) ),]
```

## Cleaning Opening Names
```{r}
games$opening_name <- str_split_fixed(games$opening_name, ":", n = 2)[,1]
games$opening_name <- str_split_fixed(games$opening_name, " [#|]", n = 2)[,1]
head(sort(table(games$opening_name), decreasing = T), n = 20)
```

## Head
```{r}
library(kableExtra)
kable(head(games)) %>% kable_styling() %>%
  scroll_box(width = "100%", box_css = "border: 0px;")
```

```{r}
write.csv(games, "dataset/clean_games.csv")
```


