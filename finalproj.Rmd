--- 
title: "Final Project Draft"
author: "Hanlin Tong, Wendy Qian, Yishi Wang"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

Inspired by a popular and realistic new Netflix series The Queen’s Gambit, starring actress Anya Taylor-Jay portrays Beth Harmon, a gifted girl orphan struggling with a drug addiction who grew in the 1960s male-dominated world of chess and became a grandmaster and an U.S. Champion, we are interested in digging out factors that affect chess games winning rates. 

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources

## About Dataset

https://www.kaggle.com/datasnaek/chess

The chess games dataset studied in this project was collected from Kaggle.com where the publisher collected over 20,000 games from a selection of users on the site Lichess.org, which is a free and open-source Internet chess server run by a non-profit organization of the sane name. Players can play anonymously and for those members who registered are allowed to play rated games on the server.

Variables included but not limited in this study are:

•	Game ID

•	Rated (True / False)

•	Start Time

•	End Time

•	Number of Turns

•	Victory Status (Resign / Mate)

•	Winner (White / Black)

•	Time Increment: An amount of time added to the clock after each move is made.

•	Players Rating Number: Numbers represent goodness of players. Better players have higher scores which are calculated by the Glicko-2 rating method.   

•	All Moves in Standard Chess Notation: Notations that recorded the moves or the position of pieces on a chessboard by algebraic chess notation.

•	Opening Name: A list of names of chess openings which refers to the initial moves of a chess game.

•	Opening Ply: Number of moves in the opening phase.

•	Opening Eco: Standardized code for chess opening names.

No major problems or issues were found in this dataset, despite it is a three-year-old dataset, lots of information were contained within a single chess game. While exploring dataset, an interesting observation was captured. To against King’s Gambit players (a standard offensive opening), the Sicilian Defense strategy (a standard defensive opening) were used commonly among players. And we shall discuss its effect on winning rates in greater details following.  

<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation

```{r, include=FALSE}
games <- read.csv("dataset/games.csv")
```

## Cleaning Trivial Variables

The dataset has the following variables.

```{r}
colnames(games)
```

We wanted to remove ```id, created_at, last_move_at, increment_code, moves, opening_eco, opening_ply``` since some of them, like ```id``` or ```increment_code``` do not have pivotal information for our problems. Or they are providing similar information as other variables, such as ```opening_eco```.

The rest variables are:

```{r}
games <- games[-c(1,3,4,8, 13, 14,16)]
colnames(games)
```

## Cleaning Rated Status
```{r}
table(games$rated)
```

We changed all the strings to uppercase letter for consistency. 

```{r}
library(stringr)
games$rated <- str_to_upper(games$rated)
table(games$rated)
```

## Cleaning Turns
```{r}
library(ggplot2)
ggplot(data = games, aes(x = turns)) + geom_histogram(bins = 50) +
  geom_vline(xintercept = 10, color = "red")

games <- games[games$turns >= 10,]
```


## Cleaning Users
```{r}
tb <- table(c(games$white_id, games$black_id))
tb <- tb[tb >= 3]
ggplot(as.data.frame(tb), aes(x = Freq)) + geom_histogram() + geom_vline(xintercept = 3, color = "red") +
  xlab("Number of games each player played")

games <- games[(games$white_id %in% names(tb) & games$black_id %in% names(tb) ),]
```

## Cleaning Opening Names
```{r}
games$opening_name <- str_split_fixed(games$opening_name, ":", n = 2)[,1]
games$opening_name <- str_split_fixed(games$opening_name, " [#|]", n = 2)[,1]
head(sort(table(games$opening_name), decreasing = T), n = 20)
```

## Head
```{r}
library(kableExtra)
kable(head(games)) %>% kable_styling() %>%
  scroll_box(width = "100%", box_css = "border: 0px;")
```

```{r}
write.csv(games, "dataset/clean_games.csv")
```



<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

```{r, include=FALSE}
clean_games <- read.csv("dataset/clean_games.csv")
```

## Check Missing Values

```{r}
library(mi)
x <- missing_data.frame(clean_games)
image(x)
```

Based on the missing data plot, the dark represents missing value. As the plot shows, there is no dark area so that we don't have to take any actions to deal with this problem.

```{r}
table(is.na(clean_games))
```

We use `is.na()` to double-check the missing values in the dataset. As the table shows, there is no missing values in this dataset.

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

```{r, include=FALSE}
clean_games <- read.csv("dataset/clean_games.csv")
```


<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

